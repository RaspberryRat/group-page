<h1 class="font-bold text-2xl mb-12">Users</h1>

<% flash.each do |type, msg| %>
  <% if type == "alert" %>
    <div class="mb-6 w-max
      bg-red-100 border border-red-500 text-red-700 px-4 py-3 rounded
      relative" role="alert">
      <%= msg %>
    </div>
  <% else %>
    <div class="mb-6 w-max
      bg-blue-100 border border-blue-500 text-blue-700 px-4 py-3 rounded
      relative" role="alert">
      <%= msg %>
    </div>
  <% end %>
<% end %>

<% unless @users.pending?.empty? %>
 <div data-controller="hide">
    <div class="flex flex-col justify-start">
    <span class="italic bg-red-100 border border-red-500 text-red-700 px-3 py-3 rounded w-max">
      You have <%= @users.pending?.count %> user accounts waiting for approval
    </span>
    <button type="button" data-action="click->hide#show" data-hide-target="btn"
        class="mb-12 p-2
        text-white rounded-2xl border-2 border-black
        bg-blue-500 hover:bg-blue-600 active:bg-blue-700
        focus:outline-white focus:ring focus:ring-violet-300
        w-max text-center self-start mt-6">
      Show Pending Users
    </button>
  </div>
  <table class="w-4/5 border-separate border-spacing-2 hidden" data-hide-target="element">
    <caption class="text-left underline text-lg pl-6 font-bold">Users Pending Approval</caption>
    <tr>
      <th>id</th>
      <th>email</th>
      <th>admin?</th>
      <th>post articles?</th>
      <th>event organizer?</th>
      <th>date user added</th>
      <th>       </th>
      <th>       </th>
    </tr>
    <% @users.pending?.each do |user| %>
      <tr>
        <td class="text-center text-blue-700 hover:text-lg hover:scale-125">
          <%= link_to user.id, user_path(user.id) %>
        </td>
        <td class="text-center text-blue-700 hover:text-lg hover:scale-125">
          <%= link_to user.email, user_path(user.id) %>
        </td>
        <td class="text-center" data-controller="auto-submit">
          <%= form_with model: user do |form| %>
            <%= form.check_box :admin,
                               data: { action: 'click->auto-submit#click'}%>
            <%= form.submit '', class: 'hidden',
                            data: { auto_submit_target: 'submit' }%>
          <% end %>
        </td>
        <td class="text-center" data-controller="auto-submit">
          <%= form_with model: user do |form| %>
            <%= form.check_box :poster,
                               data: { action: 'click->auto-submit#click'} %>
            <%= form.submit '', class: 'hidden',
                            data: { auto_submit_target: 'submit' } %>
          <% end %>
        </td>
        <td class="text-center" data-controller="auto-submit">
          <%= form_with model: user do |form| %>
            <%= form.check_box :organizer,
                               data: { action: 'click->auto-submit#click'} %>
            <%= form.submit '', class: 'hidden',
                            data: { auto_submit_target: 'submit' } %>
          <% end %>
        </td>
        <td class="text-center">
          <%= user.created_at.strftime("%Y-%m-%d") %>
        </td>
        <td class="text-center p-2
        text-white rounded-2xl border-2 bg-red-400
        hover:bg-blue-1000
        w-32 text-center">
          <%= button_to "Reject User", user_path(user), method: :delete,
                        data: { turbo_method: :delete,
                                turbo_confirm: "Are you sure? This action cannot be undone" } %>
        </td>
        <td class="text-center p-2
        text-white rounded-2xl border-2 bg-blue-600
        hover:bg-blue-500 active:bg-blue-900
        w-32 text-center">
          <%= form_with model: user do |form| %>
            <%= form.hidden_field :approve, value: true %>
            <%= form.button type: :submit, data: { confirm: 'Are you sure you want to approve this user?' } do %>
            Approve User
            <% end %>
          <% end %>

        </td>
      </tr>
    <% end %>

  </table>
 </div>
<% end %>
<table class="w-4/5 border-separate border-spacing-2 mt-12">
  <caption class="text-left underline text-lg pl-6 font-bold">Approved Users</caption>
  <tr>
    <th>id</th>
    <th>email</th>
    <th>admin?</th>
    <th>post articles?</th>
    <th>event organizer?</th>
    <th>date user added</th>
    <th>       </th>
  </tr>
  <% @users.approved?.each do |user| %>
  <tr>
    <td class="text-center text-blue-700 hover:text-lg hover:scale-125">
      <%= link_to user.id, user_path(user.id) %>
    </td>
    <td class="text-center text-blue-700 hover:text-lg hover:scale-125">
      <%= link_to user.email, user_path(user.id) %>
    </td>
    <td class="text-center" data-controller="auto-submit">
      <%= form_with model: user do |form| %>
        <%= form.check_box :admin,
          data: { action: 'click->auto-submit#click'}%>
        <%= form.submit '', class: 'hidden',
          data: { auto_submit_target: 'submit' }%>
      <% end %>
    </td>
    <td class="text-center" data-controller="auto-submit">
      <%= form_with model: user do |form| %>
        <%= form.check_box :poster,
          data: { action: 'click->auto-submit#click'} %>
        <%= form.submit '', class: 'hidden',
          data: { auto_submit_target: 'submit' } %>
      <% end %>
    </td>
    <td class="text-center" data-controller="auto-submit">
      <%= form_with model: user do |form| %>
        <%= form.check_box :organizer,
         data: { action: 'click->auto-submit#click'} %>
        <%= form.submit '', class: 'hidden',
          data: { auto_submit_target: 'submit' } %>
      <% end %>
    </td>
    <td class="text-center">
      <%= user.created_at.strftime("%Y-%m-%d") %>
    </td>
    <td class="text-center p-2
      text-white rounded-2xl border-2 bg-red-400
      hover:bg-blue-1000
      w-32 text-center">
      <%= button_to "Delete User", user_path(user), method: :delete,
        data: { turbo_method: :delete,
                turbo_confirm: "Are you sure? This action cannot be undone" } %>
    </td>
  </tr>
  <% end %>

</table>